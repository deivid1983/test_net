Ž
MC:\Workspace\test_net\NetcoreProject\Areas\Api\Controllers\AlbumController.cs
	namespace 	
NetcoreProject
 
. 
Areas 
. 
Api "
." #
Controllers# .
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
AlbumController  
:! "

Controller# -
{		 
private

 
readonly

 
IAlbumService

 &
_albumService

' 4
;

4 5
public 
AlbumController 
( 
IAlbumService 
albumService &
) 	
{ 	
_albumService 
= 
albumService (
;( )
} 	
[ 	
Route	 
( 
$str $
)$ %
]% &
public 
IActionResult 
Get  
(  !
int! $
albumId% ,
), -
{. /
var 
result 
= 
_albumService &
.& '
Get' *
(* +
albumId+ 2
)2 3
;3 4
return 
Ok 
( 
new 
{ 
Name 
= 
result !
.! "
Name" &
,& '
Description 
=  !
result" (
.( )
Description) 4
,4 5
Photos 
= 
result #
.# $
Photos$ *
.* +
Select+ 1
(1 2
x2 3
=>4 6
x7 8
.8 9
	PhotoLink9 B
)B C
.C D
ToListD J
(J K
)K L
} 
) 
; 
} 	
}   
}!! ˜
BC:\Workspace\test_net\NetcoreProject\Controllers\HomeController.cs
	namespace 	
NetcoreProject
 
. 
Controllers $
{		 
public

 

class

 
HomeController

 
:

  !

Controller

" ,
{ 
private 
readonly 
IAlbumService &
_albumService' 4
;4 5
public 
HomeController 
( 
IAlbumService +
albumService, 8
)8 9
{ 	
_albumService 
= 
albumService (
;( )
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Create #
(# $
)$ %
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Insert #
(# $
AlbumViewModel$ 2
model3 8
)8 9
{ 	
if   
(   
!   

ModelState   
.   
IsValid   #
)  # $
{!! 
return"" 
View"" 
("" 
$str"" $
,""$ %
model""& +
)""+ ,
;"", -
}## 
var%% 
path%% 
=%% 
$"%% 
wwwroot\\uploads\\%% +
{%%+ ,
model%%, 1
.%%1 2
Photo%%2 7
.%%7 8
FileName%%8 @
}%%@ A
"%%A B
;%%B C
using'' 
('' 
var'' 
stream'' 
='' 
new''  #

FileStream''$ .
(''. /
path''/ 3
,''3 4
FileMode''5 =
.''= >
Create''> D
)''D E
)''E F
{(( 
model)) 
.)) 
Photo)) 
.)) 
CopyTo)) "
())" #
stream))# )
)))) *
;))* +
}** 
var,, 
album,, 
=,, 
new,, 
Album,, !
{-- 
Name.. 
=.. 
model.. 
... 
Name.. !
,..! "
Description// 
=// 
model// #
.//# $
Description//$ /
,/// 0
	PhotoLink00 
=00 
$"00 
	/uploads/00 '
{00' (
model00( -
.00- .
Photo00. 3
.003 4
FileName004 <
}00< =
"00= >
}11 
;11 
_albumService33 
.33 
Create33  
(33  !
album33! &
)33& '
;33' (
return55 
RedirectToAction55 #
(55# $
$str55$ +
)55+ ,
;55, -
}66 	
}77 
}88 ‚
CC:\Workspace\test_net\NetcoreProject\Controllers\PhotoController.cs
	namespace 	
NetcoreProject
 
. 
Controllers $
{ 
public 

class 
PhotoController  
:! "

Controller# -
{ 
private 
readonly 
IAlbumService &
_albumService' 4
;4 5
private 
readonly 
IPhotoService &
_photoService' 4
;4 5
public 
PhotoController 
( 
IAlbumService ,
albumService- 9
,9 :
IPhotoService; H
photoServiceI U
)U V
{ 	
_albumService 
= 
albumService (
;( )
_photoService 
= 
photoService (
;( )
} 	
public 
IActionResult 
Index "
(" #
int# &
id' )
)) *
{ 	
return 
View 
( 
_albumService 
. 
Get !
(! "
id" $
)$ %
) 
; 
} 	
[ 	
HttpPost	 
] 
public   
IActionResult   
Insert   #
(  # $
PhotoViewModel  $ 2
model  3 8
)  8 9
{!! 	
if"" 
("" 
!"" 

ModelState"" 
."" 
IsValid"" #
)""# $
{## 
return$$ 
View$$ 
($$ 
$str$$ $
,$$$ %
model$$& +
)$$+ ,
;$$, -
}%% 
var'' 
path'' 
='' 
$"'' 
wwwroot\\uploads\\'' +
{''+ ,
model'', 1
.''1 2
Photo''2 7
.''7 8
FileName''8 @
}''@ A
"''A B
;''B C
using)) 
()) 
var)) 
stream)) 
=)) 
new))  #

FileStream))$ .
()). /
path))/ 3
,))3 4
FileMode))5 =
.))= >
Create))> D
)))D E
)))E F
{** 
model++ 
.++ 
Photo++ 
.++ 
CopyTo++ "
(++" #
stream++# )
)++) *
;++* +
},, 
var.. 
photo.. 
=.. 
new.. 
Photo.. !
{// 
AlbumId00 
=00 
model00 
.00  
AlbumId00  '
,00' (
	PhotoLink11 
=11 
$"11 
	/uploads/11 '
{11' (
model11( -
.11- .
Photo11. 3
.113 4
FileName114 <
}11< =
"11= >
}22 
;22 
_photoService44 
.44 
Create44  
(44  !
photo44! &
)44& '
;44' (
return66 
RedirectToAction66 #
(66# $
$str66$ +
,66+ ,
new66- 0
{661 2
id77 
=77 
model77 
.77 
AlbumId77 "
}88 
)88 
;88 
}99 	
}:: 
};; ý
=C:\Workspace\test_net\NetcoreProject\Models\AlbumViewModel.cs
	namespace 	
NetcoreProject
 
. 
Models 
{ 
public 

class 
AlbumViewModel 
{ 
[ 	
Required	 
] 
public		 
string		 
Name		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
[

 	
Required

	 
]

 
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
] 
public 
	IFormFile 
Photo 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 
=C:\Workspace\test_net\NetcoreProject\Models\ErrorViewModel.cs
	namespace 	
NetcoreProject
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
	RequestId 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
bool		 
ShowRequestId		 !
=>		" $
!		% &
string		& ,
.		, -
IsNullOrEmpty		- :
(		: ;
	RequestId		; D
)		D E
;		E F
}

 
} ª
=C:\Workspace\test_net\NetcoreProject\Models\PhotoViewModel.cs
	namespace 	
NetcoreProject
 
. 
Models 
{ 
public 

class 
PhotoViewModel 
{ 
[ 	
Required	 
] 
public		 
int		 
AlbumId		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
[

 	
Required

	 
]

 
public 
	IFormFile 
Photo 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} À
/C:\Workspace\test_net\NetcoreProject\Program.cs
	namespace 	
NetcoreProject
 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
BuildWebHost 
( 
args 
) 
. 
Run "
(" #
)# $
;$ %
} 	
public 
static 
IWebHost 
BuildWebHost +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
=>; =
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
. 
Build 
( 
) 
; 
} 
} ±
/C:\Workspace\test_net\NetcoreProject\Startup.cs
	namespace		 	
NetcoreProject		
 
{

 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddMvc 
( 
) 
; 
var 
sqlConnection 
= 
Configuration  -
.- .
GetConnectionString. A
(A B
$strB U
)U V
;V W
services 
. 
AddDbContext !
<! "
AlbumDbContext" 0
>0 1
(1 2
options2 9
=>: <
options= D
.D E
UseSqlServerE Q
(Q R
sqlConnectionR _
)_ `
)` a
;a b
services 
. 
AddTransient !
<! "
IAlbumService" /
,/ 0
AlbumService1 =
>= >
(> ?
)? @
;@ A
services 
. 
AddTransient !
<! "
IPhotoService" /
,/ 0
PhotoService1 =
>= >
(> ?
)? @
;@ A
} 	
public"" 
void"" 
	Configure"" 
("" 
IApplicationBuilder"" 1
app""2 5
,""5 6
IHostingEnvironment""7 J
env""K N
)""N O
{## 	
if$$ 
($$ 
env$$ 
.$$ 
IsDevelopment$$ !
($$! "
)$$" #
)$$# $
{%% 
app&& 
.&& %
UseDeveloperExceptionPage&& -
(&&- .
)&&. /
;&&/ 0
app'' 
.'' 
UseBrowserLink'' "
(''" #
)''# $
;''$ %
}(( 
else)) 
{** 
app++ 
.++ 
UseExceptionHandler++ '
(++' (
$str++( 5
)++5 6
;++6 7
},, 
app.. 
... 
UseStaticFiles.. 
(.. 
)..  
;..  !
app00 
.00 
UseMvc00 
(00 
routes00 
=>00  
{11 
routes22 
.22 
MapRoute22 
(22  
$str22  +
,22+ ,
$str22- R
)22R S
;22S T
routes44 
.44 
MapRoute44 
(44  
name55 
:55 
$str55 #
,55# $
template66 
:66 
$str66 F
)66F G
;66G H
}77 
)77 
;77 
}88 	
}99 
}:: Û
YC:\Workspace\test_net\NetcoreProject\Views\Shared\Components\AlbumGallery\AlbumGallery.cs
	namespace 	
NetcoreProject
 
. 
Views 
. 
Shared %
.% &

Components& 0
.0 1
AlbumGallery1 =
{ 
public 

class 
AlbumGallery 
: 
ViewComponent  -
{ 
private 
readonly 
IAlbumService &
_albumService' 4
;4 5
public

 
AlbumGallery

 
(

 
IAlbumService

 )
albumService

* 6
)

6 7
{ 	
_albumService 
= 
albumService (
;( )
} 	
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
_albumService 
. 
GetAll $
($ %
)% &
) 
; 
} 	
} 
} 